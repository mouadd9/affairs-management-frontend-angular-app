<div #chart class="container">
    <span
        style="color: black; margin-top:20px; font-size:2.2em; padding-bottom:15px; margin-bottom:25px;"
        class="icon dash"><mat-icon
            style="padding-right: 8px; font-size: 35px !important; ">group</mat-icon>Agencies Management
    </span>

    <span style="color: black; font-size:1.8em;"
        class="padding-bottom-10 icon"><mat-icon
            style="padding-right: 7px; font-size: 27px !important; ">business</mat-icon>Agencies
    </span>

    <div class="upperSection">

        <mat-form-field appearance="outline" class="custom-form-field">
            <mat-label>Filter</mat-label>
            <input matInput type="text" (change)="filterAgencies($event)">
        </mat-form-field>

        <span class="spacer"></span>

        <button class="icon2" mat-button
            (click)="scrollToForm()"><mat-icon>add</mat-icon>Add
            Agency</button>

    </div>

    <table matSort mat-table [dataSource]="dataSource"
        style="color: white; background-color:  #11151163 !important ;">

        <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
            <td mat-cell *matCellDef="let element">{{element.id}}</td>
        </ng-container>

        <ng-container matColumnDef="agencyCode">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Agency Code
            </th>
            <td mat-cell *matCellDef="let element">{{element.agencyCode}}</td>
        </ng-container>

        <ng-container matColumnDef="address">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Address
            </th>
            <td mat-cell *matCellDef="let element">{{element.address}}</td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
            <td mat-cell *matCellDef="let element">{{element.status}}</td>
        </ng-container>

        <ng-container matColumnDef="creationDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Creation Date
            </th>
            <td mat-cell
                *matCellDef="let element">{{element.formattedCreationDate}}</td>
        </ng-container>

        <!-- New Actions column -->
        <ng-container matColumnDef="delete">
            <th mat-header-cell *matHeaderCellDef> Delete </th>
            <td mat-cell *matCellDef="let element">
                <button mat-icon-button color="warn"
                    (click)="deleteAgency(element.id)">
                    <mat-icon>delete</mat-icon>
                </button>
            </td>
        </ng-container>
        <ng-container matColumnDef="employees">
            <th mat-header-cell *matHeaderCellDef> Employees </th>
            <td mat-cell *matCellDef="let element">
                <button mat-icon-button color="warn"
                    (click)="showEmployees(element.id, element.agencyCode)">
                    <mat-icon>group</mat-icon>
                </button>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator style="color: white; background-color: #131413c8 ;"
        [pageSizeOptions]="[5,10,15,30,50]">
    </mat-paginator>

    <div *ngIf="showEmpl" #employees style="height: auto;" class="employees">
        <div class="upperSection" style=" align-items: flex-start; height:30px; padding-bottom: 10px">
            <span style=" color: #062c06;  font-size:1.5em;"
                class=" icon"><mat-icon
                    style="padding-right: 10px;">group</mat-icon>Agency Code : {{currentAgencyCode}}
            </span>
            <span class="spacer"></span>
            <button mat-button class="icon2"
                (click)="goBack()"><mat-icon style="margin-right: 0px;">close</mat-icon></button>
        </div>
        

    

        <table matSort mat-table [dataSource]="employeeDataSource"
            style="color: white; background-color:  #11151163 !important ;">

            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
                <td mat-cell *matCellDef="let element">{{element.id}}</td>
            </ng-container>

            <ng-container matColumnDef="firstName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> First
                    Name
                </th>
                <td mat-cell
                    *matCellDef="let element">{{element.firstName}}</td>
            </ng-container>

            <ng-container matColumnDef="lastName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Last Name
                </th>
                <td mat-cell *matCellDef="let element">{{element.lastName}}</td>
            </ng-container>

            <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Email
                </th>
                <td mat-cell *matCellDef="let element">{{element.email}}</td>
            </ng-container>

            <ng-container matColumnDef="username">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Username
                </th>
                <td mat-cell *matCellDef="let element">{{element.username}}</td>
            </ng-container>

            <ng-container matColumnDef="roles">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Roles
                </th>
                <td mat-cell
                    *matCellDef="let element">{{element.roles.join(', ')}}</td>
            </ng-container>

            <!-- New Actions column -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> Actions </th>
                <td mat-cell *matCellDef="let user">
                    <button mat-icon-button color="warn"
                        (click)="deleteUser(user.id)">
                        <mat-icon>delete</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="employeeDisplayedColumns"></tr>
            <tr mat-row
                *matRowDef="let row; columns: employeeDisplayedColumns;"></tr>
        </table>

        <mat-paginator style="color: white; background-color: #131413c8 ;"
            [pageSizeOptions]="[5,10,15,30,50]">
        </mat-paginator>

    </div>

    <router-outlet #agencyFormOutlet></router-outlet>

</div>
